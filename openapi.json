{"openapi":"3.1.0","info":{"title":"Bike Tracker API","version":"1.0.0","description":"バイク走行ルートを記録・管理するAPI"},"security":[{"Bearer":[]}],"components":{"securitySchemes":{"Bearer":{"type":"http","scheme":"bearer","bearerFormat":"JWT","description":"JWTトークンを入力"}},"schemas":{},"parameters":{}},"paths":{"/auth/signup":{"post":{"tags":["Auth"],"summary":"ユーザー登録","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"email":{"type":"string","format":"email"},"password":{"type":"string","minLength":8},"name":{"type":"string","minLength":1,"maxLength":50}},"required":["email","password","name"]}}}},"responses":{"201":{"description":"登録成功","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string"},"user":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string","nullable":true},"name":{"type":"string","nullable":true}},"required":["id","email","name"]}},"required":["token","user"]}}}},"400":{"description":"バリデーションエラー","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}},"409":{"description":"メール重複","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}}},"/auth/login":{"post":{"tags":["Auth"],"summary":"ログイン","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"email":{"type":"string","format":"email"},"password":{"type":"string","minLength":1}},"required":["email","password"]}}}},"responses":{"200":{"description":"ログイン成功","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string"},"user":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string","nullable":true},"name":{"type":"string","nullable":true}},"required":["id","email","name"]}},"required":["token","user"]}}}},"401":{"description":"認証失敗","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}}},"/auth/apple":{"post":{"tags":["Auth"],"summary":"Apple IDログイン","requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"idToken":{"type":"string","minLength":1},"name":{"type":"string"}},"required":["idToken"]}}}},"responses":{"200":{"description":"ログイン成功","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string"},"user":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string","nullable":true},"name":{"type":"string","nullable":true}},"required":["id","email","name"]}},"required":["token","user"]}}}},"201":{"description":"新規登録成功","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string"},"user":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string","nullable":true},"name":{"type":"string","nullable":true}},"required":["id","email","name"]}},"required":["token","user"]}}}},"401":{"description":"トークン検証失敗","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}}},"/auth/refresh":{"post":{"tags":["Auth"],"summary":"トークンリフレッシュ","security":[{"Bearer":[]}],"responses":{"200":{"description":"新トークン","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string"}},"required":["token"]}}}},"401":{"description":"認証失敗","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}}},"/auth/me":{"get":{"tags":["Auth"],"summary":"現在のユーザー情報","security":[{"Bearer":[]}],"responses":{"200":{"description":"ユーザー情報","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string","nullable":true},"name":{"type":"string","nullable":true}},"required":["id","email","name"]}}}},"401":{"description":"認証失敗","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}}},"/routes":{"post":{"tags":["Routes"],"summary":"記録開始","security":[{"Bearer":[]}],"responses":{"201":{"description":"記録開始","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string"},"status":{"type":"string"}},"required":["id","status"]}}}},"401":{"description":"認証エラー","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}},"get":{"tags":["Routes"],"summary":"履歴一覧","security":[{"Bearer":[]}],"parameters":[{"schema":{"type":"string"},"required":false,"name":"from","in":"query"},{"schema":{"type":"string"},"required":false,"name":"to","in":"query"},{"schema":{"type":"string"},"required":false,"name":"cursor","in":"query"},{"schema":{"type":"number","minimum":1,"maximum":100,"default":20},"required":false,"name":"limit","in":"query"}],"responses":{"200":{"description":"ルート一覧","content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"userId":{"type":"string"},"title":{"type":"string","nullable":true},"startedAt":{"type":"string"},"endedAt":{"type":"string","nullable":true},"distanceM":{"type":"number","nullable":true},"durationS":{"type":"number","nullable":true},"avgSpeedKmh":{"type":"number","nullable":true},"maxSpeedKmh":{"type":"number","nullable":true},"status":{"type":"string"},"createdAt":{"type":"string"}},"required":["id","userId","title","startedAt","endedAt","distanceM","durationS","avgSpeedKmh","maxSpeedKmh","status","createdAt"]}},"nextCursor":{"type":"string","nullable":true}},"required":["data","nextCursor"]}}}}}}},"/routes/{id}":{"get":{"tags":["Routes"],"summary":"ルート詳細（ポイント含む）","security":[{"Bearer":[]}],"parameters":[{"schema":{"type":"string"},"required":true,"name":"id","in":"path"}],"responses":{"200":{"description":"ルート詳細","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string"},"userId":{"type":"string"},"title":{"type":"string","nullable":true},"startedAt":{"type":"string"},"endedAt":{"type":"string","nullable":true},"distanceM":{"type":"number","nullable":true},"durationS":{"type":"number","nullable":true},"avgSpeedKmh":{"type":"number","nullable":true},"maxSpeedKmh":{"type":"number","nullable":true},"status":{"type":"string"},"createdAt":{"type":"string"},"points":{"type":"array","items":{"type":"object","properties":{"latitude":{"type":"number","minimum":-90,"maximum":90},"longitude":{"type":"number","minimum":-180,"maximum":180},"altitude":{"type":"number"},"speed":{"type":"number","minimum":0},"heading":{"type":"number","minimum":0,"maximum":360},"accuracy":{"type":"number","minimum":0},"recordedAt":{"type":"string"},"id":{"type":"string"},"routeId":{"type":"string"}},"required":["latitude","longitude","recordedAt","id","routeId"]}}},"required":["id","userId","title","startedAt","endedAt","distanceM","durationS","avgSpeedKmh","maxSpeedKmh","status","createdAt","points"]}}}},"404":{"description":"未検出","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}},"patch":{"tags":["Routes"],"summary":"タイトル編集","security":[{"Bearer":[]}],"parameters":[{"schema":{"type":"string"},"required":true,"name":"id","in":"path"}],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"title":{"type":"string","minLength":1,"maxLength":200}},"required":["title"]}}}},"responses":{"200":{"description":"更新成功","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string"},"title":{"type":"string"}},"required":["id","title"]}}}},"404":{"description":"未検出","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}},"delete":{"tags":["Routes"],"summary":"ルート削除","security":[{"Bearer":[]}],"parameters":[{"schema":{"type":"string"},"required":true,"name":"id","in":"path"}],"responses":{"200":{"description":"削除成功","content":{"application/json":{"schema":{"type":"object","properties":{"deleted":{"type":"boolean"}},"required":["deleted"]}}}},"404":{"description":"未検出","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}}},"/routes/{id}/stop":{"patch":{"tags":["Routes"],"summary":"記録停止（距離・速度を自動計算）","security":[{"Bearer":[]}],"parameters":[{"schema":{"type":"string"},"required":true,"name":"id","in":"path"}],"responses":{"200":{"description":"記録停止","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string"},"status":{"type":"string"},"distanceM":{"type":"number"},"durationS":{"type":"number"}},"required":["id","status","distanceM","durationS"]}}}},"404":{"description":"未検出","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}}},"/routes/{id}/points":{"post":{"tags":["Routes"],"summary":"GPSポイントバッチ送信","description":"accuracy > 50m のポイントは自動除外。100件ずつバッチinsert。","security":[{"Bearer":[]}],"parameters":[{"schema":{"type":"string"},"required":true,"name":"id","in":"path"}],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"points":{"type":"array","items":{"type":"object","properties":{"latitude":{"type":"number","minimum":-90,"maximum":90},"longitude":{"type":"number","minimum":-180,"maximum":180},"altitude":{"type":"number"},"speed":{"type":"number","minimum":0},"heading":{"type":"number","minimum":0,"maximum":360},"accuracy":{"type":"number","minimum":0},"recordedAt":{"type":"string"}},"required":["latitude","longitude","recordedAt"]},"minItems":1,"maxItems":500}},"required":["points"]}}}},"responses":{"200":{"description":"送信成功","content":{"application/json":{"schema":{"type":"object","properties":{"received":{"type":"number"},"stored":{"type":"number"}},"required":["received","stored"]}}}},"400":{"description":"バリデーションエラー","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}},"404":{"description":"未検出","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"object","properties":{"code":{"type":"string"},"message":{"type":"string"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["message"]}}},"required":["code","message"]}},"required":["error"]}}}}}}}}}